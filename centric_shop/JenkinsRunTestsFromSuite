pipeline {
  agent any

  stages {
      stage('Install Dependencies') {
        steps {
          dir('centric_shop') {
          script {
            // Install bundle and change the user
            sh 'bundle install'
            sh 'su jenkins'
           }
         }
       }
     }

    stage('Divide Test Cases') {
      steps {
        dir('centric_shop') {
        script {
          sh 'ruby divide_test_case.rb'
         }
        }
      }
    }

    stage('Run Test Cases') {
      steps {
        dir('centric_shop') {
        script {
          // Retrieve the list of suites generated by cuke-slicer
          def suites = sh(returnStdout: true, script: 'ls -1 suite_*.feature').trim().split('\n')
          println "${suites}"

          for (int i = 0; i < suites.size(); i++) {
            def suite = suites[i]
            def fileContent = readFile "${suite}"
            def featureFile = fileContent[0]
            echo "File Content ---- ${featureFile}"

            def testSuite = fileContent[0]
            echo "Printing test suite -------- ${testSuite}"
            // Run each suite of test cases on the Jenkins slave
            println "Running tests from ${suite}"
            sh "cucumber ${testSuite}"
           }
         }
       }
     }
   }


    // Add more stages for additional pipeline steps
    // ...
  }
}
